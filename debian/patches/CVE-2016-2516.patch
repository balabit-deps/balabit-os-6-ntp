Description: fix DoS via duplicate IPs on unconfig directives
Origin: backport, http://pkgs.fedoraproject.org/cgit/rpms/ntp.git/tree/ntp-4.2.6p5-cve-2016-2516.patch
Bug: http://support.ntp.org/bin/view/Main/NtpBug3011

Index: ntp-4.2.8p4+dfsg/ntpd/ntp_request.c
===================================================================
--- ntp-4.2.8p4+dfsg.orig/ntpd/ntp_request.c	2016-05-31 13:53:43.730379147 -0400
+++ ntp-4.2.8p4+dfsg/ntpd/ntp_request.c	2016-05-31 13:57:15.917071875 -0400
@@ -1476,11 +1476,12 @@
 			if (FLAG_CONFIG & p->flags)
 				found = TRUE;
 		}
-		INSIST(found);
-		INSIST(NULL != p);
+		if (found) {
+			INSIST(NULL != p);
 
-		peer_clear(p, "GONE");
-		unpeer(p);
+			peer_clear(p, "GONE");
+			unpeer(p);
+		}
 
 		datap += item_sz;
 	}
