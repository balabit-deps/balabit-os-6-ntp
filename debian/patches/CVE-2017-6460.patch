

    TOPntp-stable1.3722.2.10 changes

NTP - Network Time Protocol
#### ChangeSet ####

2017-02-11 19:30:47+01:00, perlinger@ntp.org
  [Sec 3377] NTP-01-002 Buffer Overflow in ntpq when fetching reslist

#==== ChangeLog ====
#
#2017-02-11 19:30:47+01:00, perlinger@ntp.org +4 -0
#  [Sec 3377] NTP-01-002 Buffer Overflow in ntpq when fetching reslist
#--- 1.1853.2.5/ChangeLog	2017-02-01 13:07:08 +00:00
#+++ 1.1853.2.6/ChangeLog	2017-02-11 18:30:47 +00:00
#@@ -1,3 +1,7 @@
#+---
#+* [Sec 3377] NTP-01-002 Buffer Overflow in ntpq when fetching reslist
#+  (Pentest report 01.2017) <perlinger@ntp.org
#+
# ---
# (4.2.8p9-win) 2017/02/01 Released by Harlan Stenn <stenn@ntp.org>
# 
#
#==== ntpq/ntpq-subs.c ====
#
#2017-02-11 19:30:47+01:00, perlinger@ntp.org +4 -2
#  [Sec 3377] NTP-01-002 Buffer Overflow in ntpq when fetching reslist
Index: ntp-4.2.8p4+dfsg/ntpq/ntpq-subs.c
===================================================================
--- ntp-4.2.8p4+dfsg.orig/ntpq/ntpq-subs.c	2017-06-28 10:22:33.020191317 -0400
+++ ntp-4.2.8p4+dfsg/ntpq/ntpq-subs.c	2017-06-28 10:22:33.016191267 -0400
@@ -3577,11 +3577,13 @@ reslist(
 				if (NULL == val) {
 					row.flagstr[0] = '\0';
 					comprende = TRUE;
-				} else {
-					len = strlen(val);
+				} else if ((len = strlen(val)) < sizeof(row.flagstr)) {
 					memcpy(row.flagstr, val, len);
 					row.flagstr[len] = '\0';
 					comprende = TRUE;
+				} else {
+					 /* no flags, and still !comprende */
+					row.flagstr[0] = '\0';
 				}
 			}
 			break;
